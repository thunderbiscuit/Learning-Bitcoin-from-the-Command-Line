<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sending Coins with Automated Raw Transactions - Learning Bitcoin from the Command Line</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01_0_Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="01_1_Introducing_Bitcoin.html"><strong aria-hidden="true">1.1.</strong> Introducing Bitcoin</a></li></ol></li><li class="chapter-item expanded "><a href="02_0_Setting_Up_a_Bitcoin-Core_VPS.html"><strong aria-hidden="true">2.</strong> Setting Up a Bitcoin Core VPS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="02_1_Setting_Up_a_Bitcoin-Core_VPS_with_StackScript.html"><strong aria-hidden="true">2.1.</strong> With Bitcoin Standup</a></li><li class="chapter-item expanded "><a href="02_2_Setting_Up_Bitcoin_Core_Other.html"><strong aria-hidden="true">2.2.</strong> Via Other Means</a></li></ol></li><li class="chapter-item expanded "><a href="03_0_Understanding_Your_Bitcoin_Setup.html"><strong aria-hidden="true">3.</strong> Understanding your Bitcoin Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="03_1_Verifying_Your_Bitcoin_Setup.html"><strong aria-hidden="true">3.1.</strong> Verifying your Bitcoin Setup</a></li><li class="chapter-item expanded "><a href="03_2_Knowing_Your_Bitcoin_Setup.html"><strong aria-hidden="true">3.2.</strong> Knowing your Bitcoin Setup</a></li><li class="chapter-item expanded "><a href="03_3__Interlude_Using_Command-Line_Variables.html"><strong aria-hidden="true">3.3.</strong> Interlude: Using Command-Line Variables</a></li><li class="chapter-item expanded "><a href="03_3_Setting_Up_Your_Wallet.html"><strong aria-hidden="true">3.4.</strong> Setting Up Your Wallet</a></li><li class="chapter-item expanded "><a href="03_4_Receiving_a_Transaction.html"><strong aria-hidden="true">3.5.</strong> Receiving a Transaction</a></li><li class="chapter-item expanded "><a href="03_5_Understanding_the_Descriptor.html"><strong aria-hidden="true">3.6.</strong> Understanding the Descriptor</a></li></ol></li><li class="chapter-item expanded "><a href="04_0_Sending_Bitcoin_Transactions.html"><strong aria-hidden="true">4.</strong> Sending Bitcoin Transactions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="04_1_Sending_Coins_The_Easy_Way.html"><strong aria-hidden="true">4.1.</strong> Sending Coins the Easy Way</a></li><li class="chapter-item expanded "><a href="04_2__Interlude_Using_JQ.html"><strong aria-hidden="true">4.2.</strong> Interlude: Using JQ</a></li><li class="chapter-item expanded "><a href="04_2_Creating_a_Raw_Transaction.html"><strong aria-hidden="true">4.3.</strong> Creating a Raw Transaction</a></li><li class="chapter-item expanded "><a href="04_3_Creating_a_Raw_Transaction_with_Named_Arguments.html"><strong aria-hidden="true">4.4.</strong> Creating a Raw Transaction With Named Arguments</a></li><li class="chapter-item expanded "><a href="04_4__Interlude_Using_Curl.html"><strong aria-hidden="true">4.5.</strong> Interlude: Using Curl</a></li><li class="chapter-item expanded "><a href="04_4_Sending_Coins_with_a_Raw_Transaction.html"><strong aria-hidden="true">4.6.</strong> Sending Coins with Raw Transactions</a></li><li class="chapter-item expanded "><a href="04_5_Sending_Coins_with_Automated_Raw_Transactions.html" class="active"><strong aria-hidden="true">4.7.</strong> Sending Coins with Automated Raw Transactions</a></li><li class="chapter-item expanded "><a href="04_6_Creating_a_Segwit_Transaction.html"><strong aria-hidden="true">4.8.</strong> Creating a Segwit Transaction</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Learning Bitcoin from the Command Line</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="45-sending-coins-with-automated-raw-transactions"><a class="header" href="#45-sending-coins-with-automated-raw-transactions">4.5: Sending Coins with Automated Raw Transactions</a></h1>
<p>This chapter lays out three ways to send funds via Bitcoin's cli interface. <a href="04_1_Sending_Coins_The_Easy_Way.html">§4.1</a> described how to do so with a simple command, and <a href="04_4_Sending_Coins_with_a_Raw_Transaction.html">§4.4</a> detailed how to use a more dangerous raw transaction. This final section splits the difference by showing how to make raw transactions simpler and safer. </p>
<h2 id="let-bitcoin-calculate-for-you"><a class="header" href="#let-bitcoin-calculate-for-you">Let Bitcoin Calculate For You</a></h2>
<p>The methodology for automated raw transactions is simple: you create a raw transaction, but you use the <code>fundrawtransaction</code> command to ask the bitcoind to run the calculations for you.</p>
<p>In order to use this command, you'll need to ensure that your ~/.bitcoin/bitcoin.conf file contains rational variables for calculating transaction fees. Please see <a href="04_1_Sending_Coins_The_Easy_Way.html">§4.1: Sending Coins The Easy Way</a> for more information on this.</p>
<p>For very conservative numbers, we suggested adding the following to the <code>bitcoin.conf</code>:</p>
<pre><code>mintxfee=0.0001
txconfirmtarget=6
</code></pre>
<p>To keep the tutorial moving along (and more generally to move money fast) we suggested the following:</p>
<pre><code>mintxfee=0.001
txconfirmtarget=1
</code></pre>
<h2 id="create-a-bare-bones-raw-transaction"><a class="header" href="#create-a-bare-bones-raw-transaction">Create a Bare Bones Raw Transaction</a></h2>
<p>To use <code>fundrawtransaction</code> you first need to create a bare-bones raw transaction that lists <em>no</em> inputs and <em>no</em> change address. You'll just list your recipient and how much you want to send them, in this case <code>$recipient</code> and <code>0.0002</code> BTC.</p>
<pre><code>$ recipient=n2eMqTT929pb1RDNuqEnxdaLau1rxy3efi
$ unfinishedtx=$(bitcoin-cli -named createrawtransaction inputs='''[]''' outputs='''{ &quot;'$recipient'&quot;: 0.0002 }''')
</code></pre>
<h2 id="fund-your-bare-bones-transaction"><a class="header" href="#fund-your-bare-bones-transaction">Fund Your Bare Bones Transaction</a></h2>
<p>You then tell <code>bitcoin-cli</code> to fund that bare-bones transaction:</p>
<pre><code>$ bitcoin-cli -named fundrawtransaction hexstring=$unfinishedtx
{
  &quot;hex&quot;: &quot;02000000012db87641c6a21e5a68b20c226428544978e6ac44964d5d8060d7388000c584eb0100000000feffffff02204e0000000000001976a914e7c1345fc8f87c68170b3aa798a956c2fe6a9eff88ac781e0000000000001600140cc9cdcf45d4ea17f5227a7ead52367aad10a88400000000&quot;,
  &quot;fee&quot;: 0.00022200,
  &quot;changepos&quot;: 1
}
</code></pre>
<p>That provides a lot of useful information, but once you're confident with how it works, you'll want to use JQ to save your hex to a variable, as usual:</p>
<pre><code>$ rawtxhex3=$(bitcoin-cli -named fundrawtransaction hexstring=$unfinishedtx | jq -r '.hex')
</code></pre>
<h2 id="verify-your-funded-transaction"><a class="header" href="#verify-your-funded-transaction">Verify Your Funded Transaction</a></h2>
<p>It seems like magic, so the first few times you use <code>fundrawtransaction</code>, you'll probably want to verify it.</p>
<p>Running <code>decoderawtransaction</code> will show that the raw transaction is now laid out correctly, using one or more of your UTXOs and sending excess funds back to a change address:</p>
<pre><code>$ bitcoin-cli -named decoderawtransaction hexstring=$rawtxhex3
{
  &quot;txid&quot;: &quot;b3b4c2057dbfbef6690e975ede92fde805ddea13c730f58401939a52c9ac1b99&quot;,
  &quot;hash&quot;: &quot;b3b4c2057dbfbef6690e975ede92fde805ddea13c730f58401939a52c9ac1b99&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 116,
  &quot;vsize&quot;: 116,
  &quot;weight&quot;: 464,
  &quot;locktime&quot;: 0,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;eb84c5008038d760805d4d9644ace67849542864220cb2685a1ea2c64176b82d&quot;,
      &quot;vout&quot;: 1,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;&quot;,
        &quot;hex&quot;: &quot;&quot;
      },
      &quot;sequence&quot;: 4294967294
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00020000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_DUP OP_HASH160 e7c1345fc8f87c68170b3aa798a956c2fe6a9eff OP_EQUALVERIFY OP_CHECKSIG&quot;,
        &quot;hex&quot;: &quot;76a914e7c1345fc8f87c68170b3aa798a956c2fe6a9eff88ac&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;pubkeyhash&quot;,
        &quot;addresses&quot;: [
          &quot;n2eMqTT929pb1RDNuqEnxdaLau1rxy3efi&quot;
        ]
      }
    },
    {
      &quot;value&quot;: 0.00007800,
      &quot;n&quot;: 1,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;0 a782f4c6e1e75a5b24f3d675d6f11b5ebf3b2142&quot;,
        &quot;hex&quot;: &quot;0014a782f4c6e1e75a5b24f3d675d6f11b5ebf3b2142&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;witness_v0_keyhash&quot;,
        &quot;addresses&quot;: [
          &quot;tb1q57p0f3hpuad9kf8n6e6adugmt6lnkg2zzr592r&quot;
        ]
      }
    }
  ]
}
</code></pre>
<p>One thing of interest here is the change address, which is the second <code>vout</code>. Note that it's a <code>tb1</code> address, which means that it's Bech32; when we gave Bitcoin Core the total ability to manage our change, it did so using its default address type, Bech32, and it worked fine. That's why our change to SegWit addresses in <a href="04_6_Creating_a_Segwit_Transaction.html">§4.6</a> really isn't that big of a deal, but there are some gotchas for wider usage, which we'll talk about there.</p>
<p>Though we saw the fee in the <code>fundrawtransaction</code> output, it's not visible here. However, you can verify it with the <code>txfee-calc.sh</code> JQ script created in the <a href="https://github.com/BlockchainCommons/Learning-Bitcoin-from-the-Command-Line/blob/master/04_2__Interlude_Using_JQ.md">JQ Interlude</a>:</p>
<pre><code>$ ~/txfee-calc.sh $rawtxhex3
.000222
</code></pre>
<p>Finally, you can use <code>getaddressinfo</code> to see that the generated change address really belongs to you:</p>
<pre><code>$ bitcoin-cli -named getaddressinfo address=tb1q57p0f3hpuad9kf8n6e6adugmt6lnkg2zzr592r
{
  &quot;address&quot;: &quot;tb1q57p0f3hpuad9kf8n6e6adugmt6lnkg2zzr592r&quot;,
  &quot;scriptPubKey&quot;: &quot;0014a782f4c6e1e75a5b24f3d675d6f11b5ebf3b2142&quot;,
  &quot;ismine&quot;: true,
  &quot;solvable&quot;: true,
  &quot;desc&quot;: &quot;wpkh([d6043800/0'/1'/10']038a2702938e548eaec28feb92c7e4722042cfd1ea16bec9fc274640dc5be05ec5)#zpv26nar&quot;,
  &quot;iswatchonly&quot;: false,
  &quot;isscript&quot;: false,
  &quot;iswitness&quot;: true,
  &quot;witness_version&quot;: 0,
  &quot;witness_program&quot;: &quot;a782f4c6e1e75a5b24f3d675d6f11b5ebf3b2142&quot;,
  &quot;pubkey&quot;: &quot;038a2702938e548eaec28feb92c7e4722042cfd1ea16bec9fc274640dc5be05ec5&quot;,
  &quot;ischange&quot;: true,
  &quot;timestamp&quot;: 1592335137,
  &quot;hdkeypath&quot;: &quot;m/0'/1'/10'&quot;,
  &quot;hdseedid&quot;: &quot;fdea8e2630f00d29a9d6ff2af7bf5b358d061078&quot;,
  &quot;hdmasterfingerprint&quot;: &quot;d6043800&quot;,
  &quot;labels&quot;: [
  ]
}
</code></pre>
<p>Note the <code>ismine</code> results.</p>
<h2 id="send-your-funded-transaction"><a class="header" href="#send-your-funded-transaction">Send Your Funded Transaction</a></h2>
<p>At this point you can sign and send the transaction as usual.</p>
<pre><code>$ signedtx3=$(bitcoin-cli -named signrawtransactionwithwallet hexstring=$rawtxhex3 | jq -r '.hex')
$ bitcoin-cli -named sendrawtransaction hexstring=$signedtx3
8b9dd66c999966462a3d88d6ac9405d09e2aa409c0aa830bdd08dbcbd34a36fa
</code></pre>
<p>In several minutes, you'll have your change back:</p>
<pre><code>$ bitcoin-cli listunspent
[
  {
    &quot;txid&quot;: &quot;8b9dd66c999966462a3d88d6ac9405d09e2aa409c0aa830bdd08dbcbd34a36fa&quot;,
    &quot;vout&quot;: 1,
    &quot;address&quot;: &quot;tb1q57p0f3hpuad9kf8n6e6adugmt6lnkg2zzr592r&quot;,
    &quot;scriptPubKey&quot;: &quot;0014a782f4c6e1e75a5b24f3d675d6f11b5ebf3b2142&quot;,
    &quot;amount&quot;: 0.00007800,
    &quot;confirmations&quot;: 1,
    &quot;spendable&quot;: true,
    &quot;solvable&quot;: true,
    &quot;desc&quot;: &quot;wpkh([d6043800/0'/1'/10']038a2702938e548eaec28feb92c7e4722042cfd1ea16bec9fc274640dc5be05ec5)#zpv26nar&quot;,
    &quot;safe&quot;: true
  }
]
</code></pre>
<h2 id="summary-sending-coins-with-automated-raw-transactions"><a class="header" href="#summary-sending-coins-with-automated-raw-transactions">Summary: Sending Coins with Automated Raw Transactions</a></h2>
<p>If you must send funds with raw transactions then <code>fundrawtransaction</code> gives you a nice alternative where fees, inputs, and outputs are calculated for you, so you don't accidentally lose a bunch of money.</p>
<blockquote>
<p>:fire: <em><strong>What is the power of sending coins with automated raw transactions?</strong></em></p>
</blockquote>
<blockquote>
<p><em>The advantages.</em> It provides a nice balance. If you're sending funds by hand and <code>sendtoaddress</code> doesn't offer enough control for whatever reason, you can get some of the advantages of raw transactions without the dangers. This methodology should be used whenever possible if you're sending raw transactions by hand.</p>
</blockquote>
<blockquote>
<p><em>The disadvantages.</em> It's a hodge-podge. Though there are a few additional options for the <code>fundrawtransaction</code> command that weren't mentioned here, your control is still limited. You'd probably never want to use this method if you were writing a program where the whole goal is to know exactly what's going on.</p>
</blockquote>
<h2 id="whats-next"><a class="header" href="#whats-next">What's Next?</a></h2>
<p>Complete your &quot;Sending of Bitcoin Transactions&quot; with <a href="04_6_Creating_a_Segwit_Transaction.html">§4.6: Creating a Segwit Transaction</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="04_4_Sending_Coins_with_a_Raw_Transaction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="04_6_Creating_a_Segwit_Transaction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="04_4_Sending_Coins_with_a_Raw_Transaction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="04_6_Creating_a_Segwit_Transaction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
